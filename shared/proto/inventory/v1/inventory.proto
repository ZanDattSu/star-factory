syntax = "proto3";

package inventory.v1;

import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "validate/validate.proto";
import "protoc-gen-openapiv2/options/annotations.proto";


option go_package = "github.com/ZanDattSu/star-factory/shared/pkg/proto/v1;inventory_v1";

option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "Inventory Service API";
    version: "1.0.0";
    description: "API for managing spacecraft parts inventory";
  };
  schemes: HTTP;
  schemes: HTTPS;
  consumes: "application/json";
  produces: "application/json";
};

// Сервис работы с деталями
service InventoryService {
  rpc GetPart(GetPartRequest) returns (GetPartResponse) {
    option (google.api.http) = {
      get: "/api/v1/part/{uuid}"
    };
  }

  rpc ListParts(ListPartsRequest) returns (ListPartsResponse) {
    option (google.api.http) = {
      post: "/api/v1/part/list"
      body: "*"
    };
  }
}

// Категория детали
enum Category {
  CATEGORY_UNSPECIFIED = 0;
  CATEGORY_ENGINE = 1;
  CATEGORY_FUEL = 2;
  CATEGORY_PORTHOLE = 3;
  CATEGORY_WING = 4;
}

// Универсальное значение для метаданных
message Value {
  oneof kind {
    string string_value = 1;
    int64 int64_value = 2;
    double double_value = 3;
    bool bool_value = 4;
  }
}

// Размеры детали
message Dimensions {
  double length = 1 [(validate.rules).double = {gt: 0}]; // длина, см
  double width = 2  [(validate.rules).double = {gt: 0}]; // ширина, см
  double height = 3 [(validate.rules).double = {gt: 0}]; // высота, см
  double weight = 4 [(validate.rules).double = {gt: 0}]; // вес, кг
}

// Производитель
message Manufacturer {
  string name = 1;                                                                // название
  string country = 2;                                                             // страна
  string website = 3 [(validate.rules).string = {uri: true, ignore_empty: true}]; // сайт
}

// Деталь
message Part {
  string uuid = 1 [(validate.rules).string.uuid = true];                                  // ID детали
  string name = 2;                                                                        // имя
  string description = 3;                                                                 // описание
  double price = 4 [(validate.rules).double = {gt:0}];                                     // цена
  int64 stock_quantity = 5 [(validate.rules).int64 = {gte: 0}];                           // остаток на складе
  Category category = 6 [(validate.rules).enum = {defined_only: true, not_in: [0]}];      // категория

  Dimensions dimensions = 7 [(validate.rules).message.required = true];                   // размеры
  Manufacturer manufacturer = 8 [(validate.rules).message.required = true];               // производитель

  repeated string tags = 9 [(validate.rules).repeated = {unique: true}];                  // теги
  map<string, Value> metadata = 10;                                                       // доп. данные

  google.protobuf.Timestamp created_at = 11 [(validate.rules).timestamp.required = true]; // дата создания
  google.protobuf.Timestamp updated_at = 12 [(validate.rules).timestamp.required = true]; // дата обновления
}

// Запрос детали
message GetPartRequest {
  string uuid = 1 [(validate.rules).string.uuid = true]; // ID детали
}

// Ответ с деталью
message GetPartResponse {
  Part part = 1 [(validate.rules).message.required = true];
}

// Фильтр для поиска деталей
message PartsFilter {
  repeated string uuids = 1;                  // фильтр по UUID
  repeated string names = 2;                  // фильтр по имени
  repeated Category categories = 3;           // фильтр по категории
  repeated string manufacturer_countries = 4; // фильтр по стране производителя
  repeated string tags = 5;                   // фильтр по тегам
}

// Запрос списка деталей
message ListPartsRequest {
  PartsFilter filter = 1; // параметры фильтрации (все поля опциональны)
}

// Ответ со списком деталей
message ListPartsResponse {
  repeated Part parts = 1; // найденные детали
}